<!DOCTYPE html>
<html lang="ko">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;700&display=swap" rel="stylesheet">
    <title>3D Gallery</title>
    <style>
        html, body { margin:0px; height: 100%; overflow: hidden; 
            font-family: 'Pretendard', sans-serif; }

            .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .overlay-box {
            background: rgb(0, 0, 0);
            padding: 30px 30px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
        }

        .overlay-box h2 {
            margin: 0;
            font-size: 1em;
            color: rgb(255, 255, 255);
        }

        .overlay-box p {
            margin-top: 10px;
            font-size: 1em;
            color: gray;
        }
        
    </style>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@v0.169.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@v0.169.0/examples/jsm/"
        }
    }
    </script>
</head>
<body bgcolor="#c0c0c0">
    <div id="guestbook-button" style="
        position: fixed; /* í™”ë©´ì— ê³ ì • */
        top: 85%; /* ì„¸ë¡œ ì¤‘ì•™ */
        left: 50%; /* ê°€ë¡œ ì¤‘ì•™ */
        transform: translate(-50%, -50%); /* ì¤‘ì•™ìœ¼ë¡œ ë³´ì • */
        color: #ffffff;
        background-color: black;
        padding: 10px 20px;
        font-size: 20px;
        font-weight: 400;
        cursor: pointer;
        text-align: center;">
        ë°©ëª…ë¡ ì“°ëŸ¬ê°€ê¸°ğŸ“‹ğŸ–Šï¸â¡ï¸
</div>

<div class="overlay" id="overlay">
    <div class="overlay-box">
        <h2>ë°©í–¥í‚¤ â¬…ï¸â¡ï¸â¬†ï¸â¬‡ï¸ìœ¼ë¡œ ì›€ì§ì—¬ë³´ì„¸ìš”</h2>
        <p>Enterí‚¤ë¥¼ ëˆŒëŸ¬ ë‹«ê¸°</p>
    </div>
</div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ì”¬ê³¼ ì¹´ë©”ë¼, ë Œë”ëŸ¬ ì„¤ì •
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // íë¸Œë§µ ë¡œë“œ
        const cubeLoader = new THREE.CubeTextureLoader();
        const gradientTexture = cubeLoader.load(
    [
        'path_to_gradient_right.png',   // ì˜¤ë¥¸ìª½
        'path_to_gradient_left.png',    // ì™¼ìª½
        'path_to_gradient_top.png',     // ìœ„
        'path_to_gradient_bottom.png',  // ì•„ë˜
        'path_to_gradient_front.png',   // ì•
        'path_to_gradient_back.png',    // ë’¤
    ],
    () => {
        console.log('Cube map loaded successfully.');
    },
    undefined,
    (error) => {
        console.error('Error loading cube map:', error);
    }
);

        scene.background = gradientTexture;
        camera.position.set(10, 20, 220);
        camera.lookAt(0, 1, 0);

        // ì¡°ëª… ì¶”ê°€
        const ambientLight = new THREE.AmbientLight(0xffffff, 3);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7.5).normalize();
        scene.add(directionalLight);

        // Raycasterì™€ ë§ˆìš°ìŠ¤ ë²¡í„°
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let INTERSECTED = null; // í˜„ì¬ í˜¸ë²„ ì¤‘ì¸ ê°ì²´


        // GLTF ëª¨ë¸ ë¡œë“œ
        const gltfLoader = new GLTFLoader();
        let modelGroup;

        gltfLoader.load('gallery.glb', function(gltf) {
    modelGroup = gltf.scene;

    modelGroup.traverse((node) => {
        if (node.isMesh) {
            // ì´ˆê¸° ìŠ¤ì¼€ì¼ ì €ì¥
            if (!node.userData.originalScale) {
                node.userData.originalScale = node.scale.clone();
            }

            // í”„ë ˆì„ ì´ë¦„ ê´€ë ¨ ì¶”ê°€ ì„¤ì •
            if (node.name.includes("frame")) {
                node.material.emissive = new THREE.Color(0x000000);
                node.material.emissiveIntensity = 0;
                node.userData.url = `frame${node.name.replace('frame', '')}.html`;
            }
        }
    });

    // ì „ì²´ ëª¨ë¸ í¬ê¸° ì´ˆê¸°í™”
    modelGroup.scale.set(1, 1, 1);
    scene.add(modelGroup);
});

function onDocumentMouseMove(event) {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    if (modelGroup) {
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(modelGroup.children, true);

        if (intersects.length > 0) {
            const intersected = intersects[0].object;

            if (INTERSECTED !== intersected) {
                if (INTERSECTED) {
                    INTERSECTED.scale.copy(INTERSECTED.userData.originalScale); // í¬ê¸° ë³µì›
                    if (INTERSECTED.material.emissive !== undefined) {
                        INTERSECTED.material.emissive.set(0x000000); // ê¸€ë¡œìš° ì´ˆê¸°í™”
                    }
                }

                INTERSECTED = intersected;

                // í˜„ì¬ ìŠ¤ì¼€ì¼ì—ì„œ 50% í™•ëŒ€
                const newScale = INTERSECTED.userData.originalScale.clone().multiplyScalar(1.5);
                INTERSECTED.scale.copy(newScale);

                
            }
        } else {
            if (INTERSECTED) {
                INTERSECTED.scale.copy(INTERSECTED.userData.originalScale); // ì›ë˜ í¬ê¸°ë¡œ ë³µì›
                if (INTERSECTED.material.emissive !== undefined) {
                    INTERSECTED.material.emissive.set(0x000000);
                }
            }
            INTERSECTED = null;
        }
    }
}


function onDocumentMouseDown(event) {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    if (modelGroup) {
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(modelGroup.children, true);

        if (intersects.length > 0) {
            const intersected = intersects[0].object;
            if (intersected.userData && intersected.userData.url) {
                window.location.href = intersected.userData.url;
            }
        }
    }
}

window.addEventListener('mousemove', onDocumentMouseMove, false);
window.addEventListener('mousedown', onDocumentMouseDown, false);

        // í‚¤ë³´ë“œ ìƒíƒœ ì¶”ì 
        const move = { forward: false, backward: false, left: false, right: false };
        const speed = 0.7;

        function handleKeyDown(event) {
            switch(event.key) {
                case 'ArrowUp':
                    move.forward = true;
                    break;
                case 'ArrowDown':
                    move.backward = true;
                    break;
                case 'ArrowLeft':
                    move.left = true;
                    break;
                case 'ArrowRight':
                    move.right = true;
                    break;
            }
        }

        function handleKeyUp(event) {
            switch(event.key) {
                case 'ArrowUp':
                    move.forward = false;
                    break;
                case 'ArrowDown':
                    move.backward = false;
                    break;
                case 'ArrowLeft':
                    move.left = false;
                    break;
                case 'ArrowRight':
                    move.right = false;
                    break;
            }
        }

        window.addEventListener('keydown', handleKeyDown);
        window.addEventListener('keyup', handleKeyUp);

        // OrbitControls ì„¤ì • - íšŒì „ ë¹„í™œì„±í™”
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableRotate = true; // íšŒì „ ë¹„í™œì„±í™”
        controls.enablePan = false; // íŒ¨ë‹ ë¹„í™œì„±í™”
        controls.enableZoom = true;

        // ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function animate() {
            requestAnimationFrame(animate);

            // ì¹´ë©”ë¼ ì´ë™ ë¡œì§
            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            direction.y = 0;  // ìˆ˜í‰ ì´ë™ì„ ìœ„í•´ yì¶• ì œê±°
            direction.normalize();

            const right = new THREE.Vector3();
            right.crossVectors(camera.up, direction).normalize();

            if (move.forward) camera.position.addScaledVector(direction, speed);
            if (move.backward) camera.position.addScaledVector(direction, -speed);
            if (move.left) camera.position.addScaledVector(right, -speed);
            if (move.right) camera.position.addScaledVector(right, speed);

            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // ë°©ëª…ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('guestbook-button').addEventListener('click', () => {
            window.location.href = 'guestbook.html'; // ë°©ëª…ë¡ í˜ì´ì§€ë¡œ ì´ë™
        });

         // ì´ˆê¸° ì˜¤ë²„ë ˆì´ë¥¼ ë‹«ëŠ” ê¸°ëŠ¥
         const overlay = document.getElementById('overlay');
         const isFirstVisit = localStorage.getItem('visited'); // ë°©ë¬¸ ì—¬ë¶€ í™•ì¸

          if (isFirstVisit) {
               // ì´ë¯¸ ë°©ë¬¸í•œ ê²½ìš° ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
                  overlay.style.display = "none";
            } else {
               // ì²« ë°©ë¬¸ì¸ ê²½ìš° localStorageì— ê¸°ë¡
              localStorage.setItem('visited', 'true');
    }


         const closeOverlay = (event) => {
          if (event.key === "Enter") { 
              overlay.style.display = "none"; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
              window.removeEventListener('keydown', closeOverlay); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
          }
        };
window.addEventListener('keydown', closeOverlay);
    </script>
</body>
</html>
